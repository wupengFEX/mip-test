<!DOCTYPE html>
<HTML MIP>
<HEAD>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <title>地图组件</title>
    <link rel="stylesheet" type="text/css" href="https://mipcache.bdstatic.com/static/v1/mip.css">
    <link rel="canonical" href="对应的原页面地址">
    <style mip-custom>
    html, body, mip-map {
        display: block;
        width: 100%;
    }
    mip-map {
        height: 500px;
    }
    textarea {
        width: 100%;
        height: 400px;
    }
    button {
        background: red;
        width: 100px;
        height: 50px;
        margin-top: 10px;
    }
    #bot {
        height: 1000px;
        width: 100%;
    }
    </style>
</HEAD>
<body>

<textarea id="textarea">
{
    "ak": "hKhuzfFBrcL6zGm4s6b371NDxaUrhFPl",
    "location": {
        "province": "北京",
        "city": "北京市",
        "district": "海淀区",
        "street": "西北旺东路10号院百度科技园1号楼"
    },
    "controls": {
        "NavigationControl": {
        },
        "MapTypeControl": {
        }
    },
    "info": {
        "width" : 250,
        "height": 100,
        "content": "<h4>百度科技园1号楼</h4><p style='line-height:1.5;font-size:13px;'>百度科技园1号楼坐落于北京北京市海淀区西北旺东路10号院</p></div>"
    }
}
</textarea>
<button id='btn'>展示地图 start3</button>
<input type="hidden" data-cont="0" id="hid">
<script src="./mip.js"></script>
<script type="text/javascript">
alert(1);
btn.addEventListener('click', function () {
    var hid = document.querySelector('#hid');
    var count = parseInt(hid.dataset.cont, 10);
    count++;
    alert(1);
    hid.dataset.cont = count.toString();
    var $ = require('zepto');
    var map = document.querySelector('#map');
    alert(2);
    var ids = hid.dataset.cont;
    if (oldEleName) {
        var ele = document.querySelector('#map' + oldEleName);
        ele.style.height = '0px';
        ele.style.display = 'none';
    }
    alert(3);
    oldEleName = ids;
    alert(4);
    var html = '<mip-map id="map' + ids + '">'
        +   '<script type="application/json">'
        +       textarea.value
        +   '<\/script>'
        + '</mip-map>';
    $(document.body).append($(html));
    alert(5);
});
</script>
</body>
</html>
